#!/bin/sh

echo "Running full test suite with race detector..."
go test -race ./... || {
  echo "Tests failed with race detector"
  exit 1
}

echo "Running go mod tidy check..."
go mod tidy

# Check if go.sum exists, if so check both files, otherwise just go.mod
if [ -f go.sum ]; then
  git diff --exit-code go.mod go.sum || {
    echo "go.mod or go.sum needs tidying"
    exit 1
  }
else
  git diff --exit-code go.mod || {
    echo "go.mod needs tidying"
    exit 1
  }
fi

echo "âœ“ Ready to push"
