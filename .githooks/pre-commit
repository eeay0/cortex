#!/bin/sh

echo "Running go fmt..."
unformatted=$(gofmt -l .)

[ -z "$unformatted" ] || {
  echo "Unformatted files:"
  echo "$unformatted"
  exit 1
}

echo "Running go vet..."
if ls internal/*/*.go >/dev/null 2>&1 || ls cmd/*/*.go >/dev/null 2>&1; then
  go vet ./... || {
    echo "go vet failed"
    exit 1
  }
else
  echo "Skipping go vet: no Go packages found"
fi

echo "Running golangci-lint..."
golangci-lint run || {
  echo "Linting failed"
  exit 1
}

echo "Running tests..."
go test ./... || {
  echo "Tests failed"
  exit 1
}

git diff --cached --check || {
  echo "Whitespace errors detected"
  exit 1
}

echo "âœ“ All checks passed"
